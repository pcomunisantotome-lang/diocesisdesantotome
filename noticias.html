<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noticias - Diócesis de Santo Tomé</title>
    
    <!-- Metadatos para Redes Sociales (Open Graph) -->
    <meta property="og:title" content="Noticias - Diócesis de Santo Tomé">
    <meta property="og:description" content="Lee las últimas noticias y novedades de la Diócesis de Santo Tomé.">
    <meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/diocesisdesantotome.firebasestorage.app/o/LOGOS%2FEncabezado%20para%20Paginas%20(1080%20x%201080%20px).png?alt=media&token=f798c85d-1ffc-4a30-950e-8ca7f0bc7510">
    <meta property="og:url" content="https://diocesisdesantotome.com/noticias.html">
    <meta property="og:type" content="website">
    <meta property="fb:app_id" content="1497738074977879" />

    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/diocesisdesantotome.firebasestorage.app/o/LOGOS%2Flogo%20iglesia%20samaritana.png?alt=media&token=56fd32c1-bb7d-4537-83f7-ace6662ff768" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">

    <header class="bg-white/95 backdrop-blur-sm shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 lg:px-6 py-2.5">
            <div class="flex flex-wrap justify-between items-center">
                <a href="./index.html" class="flex items-center group">
                    <img src="https://firebasestorage.googleapis.com/v0/b/diocesisdesantotome.firebasestorage.app/o/LOGOS%2Flogo%20iglesia%20samaritana.png?alt=media&token=56fd32c1-bb7d-4537-83f7-ace6662ff768" class="mr-3 h-12 transition-transform duration-300 group-hover:rotate-[10deg] group-hover:scale-110" alt="Logo Diócesis" />
                    <div class="hidden sm:flex sm:flex-col">
                        <span class="text-xl font-semibold whitespace-nowrap text-gray-800 transition-colors duration-300 group-hover:text-blue-600">Diócesis de Santo Tomé</span>
                        <span class="text-sm font-light italic text-gray-500">Corrientes, Argentina</span>
                    </div>
                </a>
                 <div class="flex items-center lg:order-2">
                    <a href="./index.html" class="text-gray-800 hover:bg-gray-50 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-4 lg:px-5 py-2 lg:py-2.5 mr-2 focus:outline-none">Volver al Inicio</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="py-12">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl font-bold text-center text-gray-800 mb-12">Todas las Noticias</h1>
            <div id="all-news-list" class="space-y-8">
                <!-- Skeletons for list view -->
                <div class="bg-white rounded-lg shadow-lg p-4 flex space-x-4 animate-pulse">
                    <div class="bg-gray-200 h-32 w-1/3 rounded-md"></div>
                    <div class="flex-1 space-y-4 py-1">
                        <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                        <div class="space-y-2">
                            <div class="h-4 bg-gray-200 rounded"></div>
                            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                        </div>
                        <div class="h-4 bg-gray-200 rounded w-1/4"></div>
                    </div>
                </div>
                 <div class="bg-white rounded-lg shadow-lg p-4 flex space-x-4 animate-pulse">
                    <div class="bg-gray-200 h-32 w-1/3 rounded-md"></div>
                    <div class="flex-1 space-y-4 py-1">
                        <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                        <div class="space-y-2">
                            <div class="h-4 bg-gray-200 rounded"></div>
                            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                        </div>
                        <div class="h-4 bg-gray-200 rounded w-1/4"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Diócesis de Santo Tomé. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCIC457rky1NFQCas3uWFfIDVRBHfdbEAQ",
            authDomain: "diocesisdesantotome.firebaseapp.com",
            projectId: "diocesisdesantotome",
            storageBucket: "diocesisdesantotome.firebasestorage.app",
            messagingSenderId: "313851932898",
            appId: "1:313851932898:web:0b7e65d0da8d09d762aebb"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const allNewsList = document.getElementById('all-news-list');

        const lightenDarkenColor = (col, amt) => {
            let usePound = false;
            if (col.startsWith("#")) {
                col = col.slice(1);
                usePound = true;
            }
            const num = parseInt(col, 16);
            let r = (num >> 16) + amt;
            if (r > 255) r = 255;
            else if  (r < 0) r = 0;
            let b = ((num >> 8) & 0x00FF) + amt;
            if (b > 255) b = 255;
            else if  (b < 0) b = 0;
            let g = (num & 0x0000FF) + amt;
            if (g > 255) g = 255;
            else if (g < 0) g = 0;
            return (usePound ? "#" : "") + (g | (b << 8) | (r << 16)).toString(16).padStart(6, '0');
        };

        const createNewsListItem = (newsDoc) => {
            const news = newsDoc.data();
            const originalUrl = news.featuredImageUrl || 'https://placehold.co/400x400/e2e8f0/e2e8f0?text=...';
            let optimizedUrl = originalUrl;

            if (originalUrl.includes('firebasestorage')) {
                const urlParts = originalUrl.split('?');
                const basePath = urlParts[0];
                const token = urlParts[1];
                const fileExtension = basePath.substring(basePath.lastIndexOf('.'));
                const pathWithoutExtension = basePath.substring(0, basePath.lastIndexOf('.'));
                optimizedUrl = `${pathWithoutExtension}_600x400${fileExtension}?${token}`;
            }

            const categoryColor = news.categoryColor || '#3B82F6'; // Default to blue
            const darkerCategoryColor = lightenDarkenColor(categoryColor, -40);

            const item = document.createElement('div');
            item.className = 'bg-white rounded-lg shadow-lg overflow-hidden flex flex-col md:flex-row group transition-shadow hover:shadow-xl';
            item.innerHTML = `
                <div class="md:w-1/3 flex-shrink-0">
                    <a href="./noticia.html?id=${newsDoc.id}" class="block relative overflow-hidden aspect-video md:aspect-square">
                        <img src="${optimizedUrl}" alt="${news.title || ''}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" onerror="this.onerror=null;this.src='${originalUrl}';">
                        <span class="absolute top-3 right-3 text-white text-xs font-semibold px-3 py-1.5 rounded-full" style="background-image: linear-gradient(to right, ${categoryColor}, ${darkerCategoryColor})">${news.category || 'General'}</span>
                    </a>
                </div>
                <div class="p-6 flex-grow flex flex-col min-w-0">
                    <a href="./noticia.html?id=${newsDoc.id}" class="block">
                        <h3 class="text-xl font-bold mb-3 text-gray-800 group-hover:text-blue-600 transition-colors">${news.title || 'Título no disponible'}</h3>
                    </a>
                    <div class="text-gray-600 mb-4 flex-grow leading-relaxed">${(news.summary || 'Resumen no disponible').replace(/<[^>]+>/g, '').substring(0, 200)}...</div>
                    <a href="./noticia.html?id=${newsDoc.id}" class="mt-auto self-start font-semibold text-blue-600 hover:text-blue-700">Leer más &rarr;</a>
                </div>
            `;
            return item;
        };

        async function loadAllNews() {
            try {
                const q = query(collection(db, "noticias"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                allNewsList.innerHTML = '';
                if (querySnapshot.empty) {
                    allNewsList.innerHTML = '<p class="text-center">No hay noticias para mostrar.</p>';
                    return;
                }
                querySnapshot.forEach(doc => {
                    allNewsList.appendChild(createNewsListItem(doc));
                });
            } catch (error) {
                console.error("Error al cargar las noticias:", error);
                allNewsList.innerHTML = '<p class="text-center text-red-600">Error al cargar noticias.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadAllNews);
    </script>

</body>
</html>
